<!doctype html>
<html>
  <head>
    <title>loginPAGE</title>
  </head>
  <body>
    <h2>LOGIN. PAGE (Auth via Token)</h2>

    <input id="email" placeholder="email" />
    <input id="password" placeholder="password" />
    <button id="createBtn">login</button>

    <p id="message"></p>

    <script>
      const endpoint = "https://example.com/graphql"; // GraphQL серверийн URL

      const createBtn = document.getElementById("createBtn");
      const message = document.getElementById("message");

      createBtn.addEventListener("click", async () => {
        const email = document.getElementById("name").value;

        const password = document.getElementById("password").value;

        // localStorage-аас token-г авна
        const token = localStorage.getItem("authToken");
        if (!token) {
          message.textContent = "No token found! Please login first.";
          return;
        }

        // GraphQL mutation
        const mutation = `
        mutation CreateStudent($name: String!, $age: Int!, $grade: String!) {
          createStudent(name: $name, age: $age, grade: $grade) {
            id
            name
            age
            grade
          }
        }
      `;

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`, // token-г localStorage-аас авсан
            },
            body: JSON.stringify({
              query: mutation,
              variables: { name, age, grade },
            }),
          });

          const result = await response.json();
          console.log(result);

          if (result.data && result.data.createStudent) {
            const student = result.data.createStudent;
            message.textContent = `Student created: ${student.name}, Age: ${student.age}, Grade: ${student.grade}`;
          } else {
            message.textContent =
              "Failed to create student! Check token or input.";
          }
        } catch (error) {
          console.error(error);
          message.textContent = "Error connecting to server";
        }
      });
    </script>
  </body>
</html>
